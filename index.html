<html>
  <head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="/constants.js"></script>
    <script src="/interface.js"></script>
    <script src="/qrcodejs/qrcode.js"></script>
  </head>
  <body>
    <h1 style="text-align: center">StuckShop</h1>
    <main role="main" class="container" style="position:relative; top:20px; width:75%">
      <p>You have £<b id="n_tokens"></b> out of £<b id="total_tokens"></b> in circulation.</p>
      <p>You <b id="yeeter"></b> a yeeter.</p>

      <script>
        function update_balance() { get_balance().then(function (b) { document.getElementById("n_tokens").innerHTML = b.toFixed(2); });}
        function update_total() { total_supply().then(function (b) { document.getElementById("total_tokens").innerHTML = b.toFixed(2); });}
        function update_all() { update_balance(); update_total(); }
        ATS.Transfer().watch(function() { update_all(); });
        update_all();
      </script>
      <div class="input-group">
        <div class="input-group-prepend">
          <span class="input-group-text">£</span>
        </div>
        <input id="ats-n_tokens" type="number" step="0.01" class="form-control">
        <div class="input-group-append">
          <button class="btn btn-outline-primary" onclick="get_balance().then(function(n) {document.getElementById('ats-n_tokens').value = n; })">All mine</span>
          <button class="btn btn-outline-primary" onclick="get_balance(document.getElementById('ats-target').value).then(function(n) {document.getElementById('ats-n_tokens').value = n; })">All from target</span>
        </div>
      </div>
      <div class="input-group">
        <div class="input-group-prepend">
          <span class="input-group-text">Target</span>
        </div>
        <input id="ats-target" class="form-control">
        <div class="input-group-append">
          <button class="btn btn-outline-primary" onclick="document.getElementById('ats-target').value = ATS_TUCKSHOP">Tuck Shop</span>
          <button class="btn btn-outline-primary" onclick="document.getElementById('ats-target').value = get_wallet()">Me</span>
          <button class="btn btn-outline-primary" onclick="document.getElementById('ats-target').value = ATS_ME">Harlan</span>
          <button class="btn btn-outline-danger" onclick="document.getElementById('ats-target').value = ATS_BURN">Burn</span>
        </div>
      </div>

      <button onclick="transfer(document.getElementById('ats-target').value, document.getElementById('ats-n_tokens').value)" class="btn btn-success btn-block">Transfer</button>


      <script>
        function gen_request() {
          var to = document.getElementById('ats-target').value;
          var amount = document.getElementById('ats-n_tokens').value;
          var elem = document.getElementById("qrcode");
          elem.innerHTML = "";
          new QRCode(document.getElementById("qrcode"), {
            text: make_qr_string(to, amount),
            correctLevel : QRCode.CorrectLevel.H
          });
          // Fix QR code scaling
          elem = elem.children[1];
          elem.style.width = "100%"
          elem.style.height = "100%"
        }
      </script>

      <div id="qrcode-modal" class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content" id="qrcode">
          </div>
        </div>
      </div>
      <button onclick="gen_request()" class="btn btn-primary btn-block" data-toggle="modal" data-target="#qrcode-modal">Request</button>

      <br>

      <div id="yeeter-only" style="display:none">
        <button onclick="mint(document.getElementById('ats-n_tokens').value)" class="btn btn-warning btn-block">Mint</button>
        <button onclick="yeet()" class="btn btn-danger btn-block">Yeet</button>
      </div>
      <script>
        function update_is_yeeter() { total_supply().then(function (b) { document.getElementById("yeeter").innerHTML = is_yeeter() ? "are" : "aren't"; });}
        function update_yeeter_only() { total_supply().then(function (b) { document.getElementById("yeeter-only").style.display = is_yeeter() ? "block" : "none"; });}
        function update_yeet_all() { update_is_yeeter(); update_yeeter_only(); }
        ATS.YeeterAdded().watch(function() { update_yeet_all(); });
        ATS.YeeterRemoved().watch(function() { update_yeet_all(); });
        update_yeet_all();
      </script>
    </main>
  </body>
</html>
